%!PS-Adobe-2.0
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%        This Postscript is Copyright (c) 2016, Peter J Billam          %
% Permission is granted  to any individual or institution to use, copy, %
% modify or redistribute this software, so long as it is not resold for %
% profit, and provided this notice is retained. It is provided "as is", %
% without any express or implied warranty.    http://www.pjb.com.au     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%EndComments
%%BeginProlog
(/home/pjb/ps/lib/transforms.ps) run
/xmax currentpagedevice (PageSize) get 0 get def
/ymax currentpagedevice (PageSize) get 1 get def
/rect { 4 dict begin   [ /h /w /y /x ] { exch def } forall
  x y moveto w 0 rlineto 0 h rlineto 0 w sub 0 rlineto x y lineto closepath
end } def

%%EndProlog
%%Page: 1 1
%%BeginPageSetup
%%EndPageSetup
/Times-Bold  ymax .03 mul selectfont
  xmax .15 mul ymax .95 mul moveto (perspective_xy2uv  with no theta) show
/xh xmax .55  mul def
/yh ymax 0.27 mul def
0.8 setgray 0 0 xmax yh rectfill 0.5 setgray  % the ground
xh yh translate   % the vanishing-point must be 0,0

newpath /x0  xmax -.50 mul def   % = .05-.55 = -.50
/HelveticaBold  ymax .22 mul selectfont
% left of the vanishing-point, we start printing text at ::x0
x0 ymax  .55 mul moveto (HEMNHXWENZEYKHEMM) true charpath
x0 ymax  .35 mul moveto (EMNHXWENZEYKHEMMA) true charpath
x0 ymax  .15 mul moveto (MNHXWENZEYKHEMMAD) true charpath
x0 ymax -.05 mul moveto (MHXWENZEYKHEMMADX) true charpath
x0 ymax -.25 mul moveto (HXWENZEYKHEMMADXM) true charpath
[ x0 ] /perspective_xy2uv c_transform fill

% but right of the VP, we start the text at x0-stringwidth
newpath /x0 xmax .40 mul def
/HelveticaBold  ymax .22 mul selectfont
0 setgray
/x_start_of_string  x0 (OQCSU) stringwidth pop sub def
x_start_of_string  ymax  .55 mul moveto (QCSUO) true charpath
x_start_of_string  ymax  .35 mul moveto (OQCSU) true charpath
x_start_of_string  ymax  .15 mul moveto (UOQCS) true charpath
x_start_of_string  ymax -.05 mul moveto (SUOQC) true charpath
x_start_of_string  ymax -.25 mul moveto (CSUOQ) true charpath
[ x0 ] /perspective_xy2uv c_transform fill

showpage

%%Page: 2 2
%%BeginPageSetup
%%EndPageSetup
/Times-Bold  ymax .03 mul selectfont
  xmax .15 mul ymax .95 mul moveto (perspective_xy2uv  with theta) show
/xh xmax .55  mul def
/yh ymax 0.27 mul def
0.8 setgray 0 0 xmax yh rectfill 0.5 setgray  % the ground

/circle {
  2 index 0 index add 1 index moveto 0 360 arc
} def

xh yh translate   % the vanishing-point is now 0,0
% 0 0 10 circle fill

newpath /x0  xmax -.50 mul def   % = .05-.55 = -.50
/HelveticaBold  ymax .22 mul selectfont
% left of the vanishing-point, we start printing text at x0
x0 ymax  .55 mul moveto (HEMNHXWENZEYKHEMM) true charpath
x0 ymax  .35 mul moveto (EMNHXWENZEYKHEMMA) true charpath
x0 ymax  .15 mul moveto (MNHXWENZEYKHEMMAD) true charpath
x0 ymax -.05 mul moveto (MHXWENZEYKHEMMADX) true charpath
x0 ymax -.25 mul moveto (HXWENZEYKHEMMADXM) true charpath
[x0 30] /perspective_xy2uv c_transform fill

% but right of the VP, we start the text at x0-stringwidth
newpath /x0 xmax .40 mul def
/HelveticaBold  ymax .22 mul selectfont
0 setgray
/x_start_of_string  x0 (OQCSU) stringwidth pop sub def
x_start_of_string  ymax  .55 mul moveto (QCSUO) true charpath
x_start_of_string  ymax  .35 mul moveto (OQCSU) true charpath
x_start_of_string  ymax  .15 mul moveto (UOQCS) true charpath
x_start_of_string  ymax -.05 mul moveto (SUOQC) true charpath
x_start_of_string  ymax -.25 mul moveto (CSUOQ) true charpath
[x0 30] /perspective_xy2uv c_transform fill

showpage

%%Page: 3 3
%%BeginPageSetup
%%EndPageSetup


newpath
0.8 setgray
/w xmax .04 mul def
xmax .005 mul setlinewidth
.03 .06 .93 {     /x exch xmax mul def
  .03 .04 .96 {  /y exch ymax mul def
    x y w w rect
  } for
} for

% [x_amplitude y_wavelength y_phase  y_amplitude x_wavelength x_phase]
/params [9 300 0  6 200 90] def
params /sine_xy2uv c_transform fill

newpath 0.5 setgray
10 205 moveto   15 5 580 { 205 lineto } for
params /sine_xy2uv c_transform stroke
% a simple long lineto does not become wavy ; only the joinpoints get moved!
/Times-Bold  ymax .03 mul selectfont 0 setgray
  xmax .15 mul ymax .95 mul moveto (sine_xy2uv) show

showpage

%%Page: 4 4
%%BeginPageSetup
%%EndPageSetup

%/hardlens_xy2uv {   % params: [ xcentre ycentre r magnification ]
%  10 dict begin  [ /y /x ] { exch def } forall
%  /x0 ::p 0 get def  /y0  ::p 1 get def
%  /r0 ::p 2 get def  /mag ::p 3 get def
%  /r  x x0 sub dup mul  y y0 sub dup mul  add  sqrt  def
%  r r0 ge {
%    /u x def  /v y def
%  } {
%    /stretch  r r0 div 90 mul cos  mag 1 sub  mul  1 add  def
%    % problem: if mag>2 then some points inside get moved to outside :-(
%    r r0 div stretch mul 1.0 gt { /stretch r0 r div def } if   % kludge
%    /u  x x0 sub stretch mul  x0 add  def
%    /v  y y0 sub stretch mul  y0 add  def
%  } ifelse
%  u v
%  end
%} def

%/softlens_xy2uv {   % params: [ xcentre ycentre r magnification ]
%  10 dict begin  [ /y /x ] { exch def } forall
%  /x0 ::p 0 get def  /y0  ::p 1 get def
%  /r0 ::p 2 get def  /mag ::p 3 get def
%  /r  x x0 sub dup mul  y y0 sub dup mul  add  sqrt  def
%  r r0 ge {
%    /u x def  /v y def
%  } {
%    /stretch  r r0 div 180 mul cos  1 add  0.5 mul mag 1 sub mul  1 add  def
%    % problem: if mag>2 then some points inside get moved to outside :-(
%    r r0 div stretch mul 1.0 gt { /stretch r0 r div def } if   % kludge
%    /u  x x0 sub stretch mul  x0 add  def
%    /v  y y0 sub stretch mul  y0 add  def
%  } ifelse
%  u v
%  end
%} def

%/twist_xy2uv {   % params: [ xcentre ycentre r angle ]
%  10 dict begin  [ /y /x ] { exch def } forall
%  /x0 ::p 0 get def  /y0  ::p 1 get def
%  /r0 ::p 2 get def  /ang ::p 3 get def
%  /r  x x0 sub dup mul  y y0 sub dup mul  add  sqrt  def
%  r 0 eq {
%    x y
%  } {
%    /theta  y y0 sub  x x0 sub  atan def
%    /newtheta 2.718281828  0 r r0 div sub  exp  ang  mul theta add  def
%    /u  r newtheta cos mul  x0 add  def
%    /v  r newtheta sin mul  y0 add  def
%    u v
%  } ifelse
%  end
%} def

newpath
0.8 setgray
/w xmax .04 mul def
xmax .005 mul setlinewidth
.03 .06 .93 {     /x exch xmax mul def
  .03 .04 .96 {  /y exch ymax mul def
    x y w w rect
  } for
} for

[ 120 700 80 1.8 ]  /softlens_xy2uv c_transform
[ 120 450 80 1.8 ]  /hardlens_xy2uv c_transform
[ 350 200 70 60 ]  /twist_xy2uv    c_transform
stroke

/Times-Bold  ymax .03 mul selectfont 0 setgray
  xmax .05 mul ymax .95 mul moveto (softlens_xy2uv) show
  xmax .05 mul ymax .65 mul moveto (hardlens_xy2uv) show
  xmax .05 mul 200 moveto (twist_xy2uv) show


showpage

%%Page: 5 5
%%BeginPageSetup
%%EndPageSetup
/Times-Bold  ymax .03 mul selectfont 0 setgray
  xmax .15 mul ymax .95 mul moveto (collapse_xy2uv) show

showpage

%%EOF
