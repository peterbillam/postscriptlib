<HTML><HEAD><TITLE>transforms.ps Manual</TITLE>
<LINK rel=stylesheet type="text/css" href="styles.css" title="PJB Comp Styles">
<META HTTP-EQUIV="Keywords"
CONTENT="PostScript, line drawing, shading">
</HEAD>
<BODY LINK="#000066" VLINK="#000066" ALINK="#000066">
<DIV>
<H1><IMG SRC="logo.jpg" ALT=" " WIDTH=126 HEIGHT=52>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <I>transforms.ps</I>
</H1>
<CENTER>
<TABLE ALIGN="center" WIDTH="85%" BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left">
	<UL><LI>
	<B><A HREF="#synopsis">SYNOPSIS</A></B>
	</LI><LI>
	<B><A HREF="#description">DESCRIPTION</A></B>
	</LI></UL>
</TD><TD ALIGN="left">
	<UL><LI>
	<B><A HREF="#procedures">PROCEDURES</A></B>
	</LI><LI>
	<B><A HREF="#install">INSTALL</A></B>
	</LI></UL>
</TD><TD ALIGN="left">
	<UL><LI>
	<B><A HREF="#author">AUTHOR</A></B>
	</LI><LI>
	<B><A HREF="#changes">CHANGES</A></B>
	</LI><LI>
	<B><A HREF="#see_also">SEE&nbsp;ALSO</A></B>
	</LI></UL>
</TD></TR></TABLE>
</CENTER>


<A NAME="name"> <HR> </A>
<H3> NAME </H3>
<P>
&nbsp; &nbsp; &nbsp;
transforms.ps - Some useful transforms in PostScript
</P>

<A NAME="synopsis"> <HR> </A>
<H3> SYNOPSIS </H3>
<PRE>
 (/home/wherever/ps/lib/transforms.ps) run
 % to send it to a printer see <A HREF="include_run.html">include_run</A> . . .

 /xh 300 def  /yh 400 def  % the vanishing-point (VP)
 xh yh translate   % the vanishing-point is now 0,0
 /HelveticaBold  200  selectfont

 % left of the vanishing-point, we start printing text at x0
 /::x0 25 def
 ::x0 350 moveto  (MHXWENZEYKHEMMADX) true charpath
 <A HREF="#procedures">/perspective1_xy2uv ctransform</A> fill

 % but right of the VP, we start the text at x0-stringwidth
 /::x0   540 def
 /::theta 45 def  % at x0, the line is at 45deg to the viewer
 /x_start_of_string 540 (MHXWENZEYKHEMMADX) stringwidth pop sub def
  x_start_of_string 350 moveto (MHXWENZEYKHEMMADX) true charpath
 <A HREF="#procedures">/perspective2_xy2uv ctransform</A> fill

</PRE>

<A NAME="description"><HR></A><H3>DESCRIPTION</H3>
<P>
This module implements in PostScript some useful transforms.
<BR>
It is mostly useful for non-linear transforms,
since the linear transforms are more easily done with
<I>translate</I>, <I>scale</I> and <I>concat</I>.
<BR>
It can only transform <I>paths</I>, so to transform text
the path must be generated by using <I>charpath</I>,
then transfomed, and finally made visible by <I>fill</I> or <I>stroke</I>.
<BR>
This means that only text in Type-1 fonts can be transformed. &nbsp;
For example, the custom fonts
<I>Bitfont5x7</I>, <I>FatSimple</I> and  <I>FatSimpleItalic</I>
in <A HREF="fonts.html">fonts.ps</A> are not Type-1 fonts.
<BR>
</P><P>
The procedures here transform the current path.
&nbsp;
Unlike the built-ins <I>translate</I>, <I>scale</I> and <I>concat</I>,
they do not transform the coordinate-system and so
do not have to be protected between a <I>gsave</I> and <I>grestore</I>.
&nbsp;
Anything already stroked or filled onto the page is of course not moved.
</P><P>
Just as a handy reference:
the PostScript matrix as used by <I>concat</I>  is the array:<BR>
<CODE> &nbsp; [ a b c d tx ty ] </CODE><BR>
where the transformation <CODE>x,y</CODE> to <CODE>x',y'</CODE> is:<BR>
<CODE> &nbsp; x' = a.x + c.y + tx</CODE><BR>
<CODE> &nbsp; y' = b.x + d.y + ty</CODE>
</P>


<A NAME="procedures"> <HR> </A>
<H3> PROCEDURES </H3>
<P><B> &nbsp; &nbsp;
<A HREF="#ctransform">ctransform</A> &nbsp;
<A HREF="#perspective1_xy2uv">perspective1_xy2uv</A> &nbsp;
<A HREF="#perspective2_xy2uv">perspective2_xy2uv</A> &nbsp;
</B></P>
<DL><DT>
<B><A NAME="ctransform"> /xy2uv_function &nbsp; ctransform</A></B>
</DT><DD><P>
This procedure comes straight from chapter 8 of
<I>Mathematical Illustrations: A Manual of Geometry and Postscript</I> by
<A HREF="http://www.math.ubc.ca/~cass/graphics/manual/">Bill Casselman</A>
and makes possible all kinds of non-linear translations of the current path.
<BR>
It takes one argument, which is a named procedure to transform the
coordinates <B>x</B> and <B>y</B> into the resulting <B>u</B> and <B>v</B>
<BR>
There now follow various such named procedures,
implementing some useful transformations&nbsp;.&nbsp;.&nbsp;.
</P>
</DD><DT>
<B><A NAME="perspective1_xy2uv">
/::x0 400 def &nbsp; /perspective1_xy2uv &nbsp; ctransform</A></B>
</DT><DD><P>
<B>perspective1_xy2uv</B> implements a simplified perspective-transformation
in which parallel lines are seen as converging toward a vanishing-point,
typically on the horizon.<BR>
The vanishing-point must be at <CODE>0,0</CODE> so you will need to
<CODE>translate</CODE> there first .&nbsp;.&nbsp;.
<BR>
<CODE>perspective1_xy2uv</CODE> will consult a variable &nbsp;
<CODE>::x0</CODE> &nbsp;
which is the <B>x</B> at which the heights are to scale 1:1.
</P><P>
The text is displayed at full width (as if viewed face-on),
which is good for legibility but is not realistic,
since in reality it would be seen from a more oblique angle.
</P><P>
The transform: if <CODE>r == u/x0</CODE> we have <CODE>v = r.y</CODE>  (easy!)<BR>
<CODE>du/dx = r = u/x0</CODE> &nbsp;
integrating: <CODE>log(u) = x/x0 + c</CODE>  or:  <CODE>u = a.exp(x/x0)</CODE>
<BR>
given:  if <CODE>x=x0</CODE> then <CODE>u=x=x0</CODE> &nbsp;
therefore:  <CODE>x0=a.e</CODE>  or:  <CODE>u = x0.exp(x/x0 - 1)</CODE>

</P></DD><DT>
<B><A NAME="perspective2_xy2uv">
/::theta 45 def &nbsp; /::x0 400 def &nbsp; /perspective2_xy2uv &nbsp; ctransform</A></B>
</DT><DD><P>
<B>perspective2_xy2uv</B> implements a more realistic
perspective-transformation
in which parallel lines converge toward a vanishing-point.
&nbsp;
The vanishing-point must be at <CODE>0,0</CODE> so you will need to
<CODE>translate</CODE> there first .&nbsp;.&nbsp;.
<BR>
<CODE>perspective2_xy2uv</CODE> will consult two variables, &nbsp;
<CODE>::x0</CODE>
which is the <B>x</B> at which the heights are to scale 1:1,<BR>
and <CODE>::theta</CODE> 
which is the angle at which the viewer sees the <CODE>x0</CODE> point.
So if <CODE>theta=90</CODE>
the viewer is face-on to the <CODE>x=u=x0</CODE> point.
In practice, <CODE>::theta</CODE> is typically between 20 and 60 degrees.
<BR>
<CODE>theta</CODE> is currently implemented in a cheap kludge
in which the obliqueness is constant all the way to the horizon,
whereas in reality the obliqueness increases as the vanising-point is
approached&nbsp;.&nbsp;.&nbsp;.
</P><P>
The text is displayed more realistically than by
<A HREF="#perspective1_xy2uv">perspective1_xy2uv</A>, &nbsp;
but at oblique angles may be less legible.

</P></DD>
</DL>

<A NAME="install"> <HR> </A>
<H3> INSTALL </H3>
<P>
To install: go to
<A HREF="http://www.pjb.com.au/comp/free/transforms.ps.txt">
www.pjb.com.au/comp/free/transforms.ps.txt</A>
and save the file to your local disc.<BR>
Rename it to <I>transforms.ps</I> and move it into some appropriate
directory such as <CODE>~/ps/lib</CODE>&nbsp;.&nbsp;.&nbsp;.
<BR>
Or, first change directory to where you keep your PostScript libraries:
<BR><CODE>
&nbsp; cd /home/wherever/ps/lib/
</CODE><BR>
(or wherever) &nbsp; and then either: <BR>
<CODE>
&nbsp; wget -O transforms.ps http://www.pjb.com.au/comp/free/transforms.ps.txt
</CODE><BR> or: <BR> <CODE>
&nbsp; curl http://www.pjb.com.au/comp/free/transforms.ps.txt -o transforms.ps
</CODE></P><P>
Or, get it from <I>github</I>:
<BR><CODE> &nbsp; &nbsp;
git clone
<A HREF="https://github.com/peterbillam/postscriptlib">
https://github.com/peterbillam/postscriptlib</A>
</CODE></P>

<A NAME="author"> <HR> </A>
<H3> AUTHOR </H3>
<P>
Peter J Billam &nbsp;
<A HREF="http://www.pjb.com.au/comp/contact.html">
www.pjb.com.au/comp/contact.html</A>
</P>

<A NAME="changes"><HR></A><H3>CHANGES</H3><PRE>
 20170717 first release
</PRE>

<A NAME="see_also"> <HR> </A>
<H3> SEE ALSO </H3>
<UL><LI>
<A HREF="http://www.math.ubc.ca/~cass/graphics/manual/">
www.math.ubc.ca/~cass/graphics/manual/</A>
</LI><LI>
<A HREF="colours.html">colours.ps</A>
</LI><LI>
<A HREF="fonts.html">fonts.ps</A>
</LI><LI>
<A HREF="include_run.html">include_run.ps</A>
</LI><LI>
<A HREF="http://www.pjb.com.au/art/posters/index.html">www.pjb.com.au/art/posters/</A>
</LI><LI>
<A HREF="http://www.pjb.com.au/">www.pjb.com.au</A>
</LI><LI>
the <I>PostScript Language Reference Manual</I> (Adobe).
</LI></UL>
</P>

<HR><CENTER><P>Back to <A HREF="index.html">P J B Computing</A> or to
<A HREF="../index.html">www.pjb.com.au</A>&nbsp;.&nbsp;.&nbsp;.</CENTER></P>
</DIV></BODY></HTML>
