% motifs for use in Peter Billam's art, posters etc

/irand     where { pop } { (/home/pjb/ps/lib/random.ps)  run } ifelse
/randomrgb where { pop } { (/home/pjb/ps/lib/colours.ps) run } ifelse

%/irand {   % usage: 6 irand     -> returns a random integer 0..5
%  rand exch round cvi mod   % arg must be much smaller than 2^32
%} bind def

/pjb::tree:depth 0 def
/bare_tree {   % x y height trunkfraction bare_tree
  % deciduous in winter, eg for silhouette against the sky
  newpath  % stroke because of changing linewidth; I could build rectangles,
  % but now we're stroking, I can use gsave grestore to get into the branches..
  % else I have to build up fractal arrays of arrays of the branch-points.
  % trunkfraction is the fraction of sap-flow that goes into the two branches.
  /pjb::tree:depth pjb::tree:depth 1 add def
  10 dict begin
  [/trunkfraction /height /y /x] {exch def} forall
  trunkfraction 0.01 lt { /trunkfraction 0.01 def } if
  trunkfraction 0.99 gt { /trunkfraction 0.99 def } if
  /branchwidth trunkfraction sqrt def
  gsave
  x y translate  height dup scale
  /trunkwidth 0.07 def   % width at ground level;  parameter ?
  % S(n) = 1 = a * (1-r^n) / (1-r)  ==>  a = (1-r) / (1-r^n)  =~ 1-r
  % r should be nearly 1 if branchwidth is small, so try r=1-branchwidth
  /a 1 branchwidth sub def  % a and r are constant, whereas
  /r branchwidth def        % trunkwidth and branchwidth shrink.
  trunkwidth setlinewidth
  0 0 moveto
  0 1 10 { /i exch def
    1.0 trunkwidth sub  i exp  0.010 lt { exit } if  % finished ?
    a r i exp mul  dup 0 0.15 grand mul  exch  rlineto
    currentpoint stroke moveto % separate strokes for separate linewidths!
    pjb::tree:depth 3 lt {
      gsave
      currentpoint translate  60 10 grand rotate 
      0 0 r i 0.5 mul 2 add exp trunkfraction bare_tree
      grestore
      gsave
      currentpoint translate -60 10 grand rotate 
      0 0 r i 0.5 mul 2 add exp trunkfraction bare_tree
      grestore
    } if
    /trunkwidth trunkwidth r mul def
    trunkwidth setlinewidth
  } for
  grestore
  end
  /pjb::tree:depth pjb::tree:depth 1 sub def
} bind def
% 297 100 442 0.5 bare_tree

/leopardskin_path {   % x y xwidth yheight spacing leopardskin_path
  % on an approximately triangular grid, with position and size
  % randomised with gauss_rand, and probably also a random choice of
  % daisy-flower-spot-shapes (with irand cvx exec, see musical_signs.ps)
  /leopardskin_dx exch def  /leopardskin_h exch def /leopardskin_w  exch def
  /leopardskin_y0 exch def  /leopardskin_x0 exch def
} bind def

/polkadots_path {     % x y xwidth yheight spacing dotsize polkadots_path
  % on a diagonal grid ? or a triangular grid ?
} bind def

/stripes_path {     % x y xwidth yheight spacing angle ratio stripes_path
  % see examples/nuits_sonores_2016.jpg
  % stripes are spacing*ratio wide ; so 0.5 gives equal strip and space
} bind def

/fish_path { % x y size fish_path
  % or: x y size fgcolour bgcolour fish  ?  to do the bg and the scales...
  /fish_size exch def  /fish_y exch def  /fish_x exch def
  fish_x  fish_y  translate  fish_size dup scale
  -0.5 0 moveto  -0.3 0.22  0.3 0.22  0.5 0 curveto
  0.3 -0.22 -0.3 -0.22 -0.5 0  curveto closepath
  1.0 fish_size div dup scale  0 fish_x sub  0 fish_y sub  translate
} bind def

%/blob {  % a random-blob-of-spilled-ink generator
% irand 5,6 or 7 excresences, x,ys grand'ed from points on a circle,
% angles rand
%}

/footprint_path {  % x y size rightleft angle footprint_path
  % if rightleft is false it's a left foot;
  /footprint_angle exch def
  /footprint_rightleft     exch def /footprint_size exch def
  /footprint_y     exch def /footprint_x    exch def
  footprint_x footprint_y translate
  footprint_angle rotate
  footprint_size dup  footprint_rightleft not { -1.0 mul } if  scale
  % the toes:
  1.5 1.0 scale
  .273 .21  moveto .273  .16 .05  90 450 arc closepath
  .263 .065 moveto .263  .03 .035 90 450 arc closepath
  .25 -.03  moveto .25  -.06 .03  90 450 arc closepath
  .23 -.105 moveto .23  -.13 .025 90 450 arc closepath
  .20 -.175 moveto .20  -.20 .025 90 450 arc closepath
  1.0 1.5 div 1.0 scale
  % the sole
   .31  .00 moveto
   .31  .15   .29  .18   .20  .18  curveto  % to ball
   .10  .18   .07  .00  -.10  .00  curveto  % to instep
  -.25  .00  -.28  .08  -.35  .08  curveto
  -.45  .08  -.48  .04  -.48  .00  curveto  % to heel
  -.48 -.10  -.40 -.16  -.30 -.16  curveto
  -.20 -.16  -.20 -.14  -.08 -.14  curveto
   .05 -.14   .12 -.20   .19 -.20  curveto
   .25 -.20   .31 -.10   .31  .00  curveto
  closepath
  1.0 footprint_size div dup  footprint_rightleft not { -1.0 mul } if  scale
  0.0 footprint_angle sub rotate
  0.0 footprint_x sub 0.0 footprint_y sub translate
} bind def

% but how to generate that random non-intersecting-squiggles-pattern,
%   where the bends and especially end-points are bulbous ?
% and what about some more poygonically-exotic tilings than chessboard_path ?

% for a different shape see also:   ~/ps/sine_curve_of_beauty.ps
/curve_of_beauty_path {  % usage: x0 y0 angle0 x1 y1 angle1
  % -ve angles mean an  S-shape  (go left, veer right, veer left)
  % +ve angles mean an inverse-S (go right, veer left, veer right)
  /beauty_a3 exch def /beauty_y3 exch def /beauty_x3 exch def
  /beauty_a0 exch def /beauty_y0 exch def /beauty_x0 exch def
  % calculate x1_out y1_out x2_out y2_out, x2_back y2_back x1_back y1_back
  beauty_x0  beauty_y0  translate
  /beauty_len beauty_x3 beauty_x0 sub dup mul  beauty_y3 beauty_y0 sub dup mul
    add sqrt def
  beauty_len  dup  scale
  % and when  x0 == x3  ??
  /beauty_rotate  beauty_y3 beauty_y0 sub  beauty_x3 beauty_x0 sub  atan  def
  beauty_rotate rotate
  newpath
    % to avoid x-over, the INSIDE y has to be smaller, the OUTSIDE larger
	% but abs supresses knowledge of which is which...
    0 0 moveto  % x0, y0
    beauty_a0 10 add cos beauty_a0 10 add 0.003 mul abs 0.4 add  mul % x1
    beauty_a0 10 add sin beauty_a0 10 add 0.003 mul abs 0.4 add  mul % y1
    1.0 beauty_a3 10 sub cos beauty_a3 10 sub 0.003 mul abs 0.4 add mul sub
    beauty_a3 10 sub sin beauty_a3 10 sub 0.003 mul abs -1.0 mul -0.4 add mul 
	1.0 0.0  curveto  % x3, y3
    1.0 beauty_a3 10 add cos beauty_a3 10 add 0.003 mul abs 0.4 add mul sub
    beauty_a3 10 add sin beauty_a3 10 add 0.003 mul abs -1.0 mul -0.4 add mul
    beauty_a0 10 sub cos beauty_a0 10 sub 0.003 mul abs 0.4 add  mul
    beauty_a0 10 sub sin beauty_a0 10 sub 0.003 mul abs 0.4 add  mul
    0.0 0.0  curveto
  closepath
  beauty_rotate -1.0 mul rotate
  1.0 beauty_len div  dup  scale
  beauty_x0 -1.0 mul  beauty_y0 -1.0 mul  translate
} bind def

/moon_path {  % usage:  x y radius solar_angle phase moon_path
  % solar_angle night means <0, =-90 or =90 means tropics
  % phase 0.0=new 0.5=full 1.0=old
  /moon::phase exch def /moon::sun_angle exch 180 add def
  /moon::r exch def /moon::y exch def /moon::x exch def
  % [ moon::x moon::y moon::r ] ==
  moon::x moon::y translate  moon::sun_angle rotate
  % better than 180 rotate, should change the angles for the arcs...
  moon::phase 0.5 ge { /moon::phase 1.0 moon::phase sub def } if
  /moon::scale 1.0 moon::phase 3.99 mul sub def  % could use sin ?
  newpath
    0 0 moon::r  90 270 arc
    moon::scale         1.0 scale
    0 0 moon::r -90 90 arcn
    1.0 moon::scale div 1.0 scale
  closepath
  moon::sun_angle -1.0 mul rotate
  moon::x -1.0 mul moon::y -1.0 mul translate
} bind def

/vedra_path {   % usage:  x_left y_left  width  vedra_path
  /vedra_width exch def /vedra_y1 exch def /vedra_x1 exch def
  newpath   % /home/pjb/photos/2008/dsc00156.jpg
  vedra_x1 vedra_y1 translate
  vedra_width 1293 div dup scale
     0    0 moveto   19   34 lineto   28   35 lineto
    56  107 lineto   85  107 lineto
    99   88 lineto  105   72 lineto  114   71 lineto  117   65 lineto
   125   64 lineto  125   68 lineto  130   68 lineto  131   64 lineto
   136   63 lineto  136   69 lineto  139   75 lineto  151   73 lineto
   154   61 lineto  160   59 lineto  162   54 lineto  170   58 lineto
   174   56 lineto  178   61 lineto  191   63 lineto  196   59 lineto
   222   78 lineto  222   89 lineto  240  101 lineto  249   95 lineto
   261  103 lineto  301   93 lineto  310   94 lineto  315   93 lineto
   319   94 lineto  329   94 lineto  338   89 lineto  352   88 lineto
   356   86 lineto  361   86 lineto  361   89 lineto  373   91 lineto
   376   88 lineto  381   91 lineto  397   91 lineto  403   97 lineto
   406   98 lineto  408  103 lineto  414  102 lineto  426  106 lineto
   435  105 lineto  436  114 lineto  443  117 lineto  453  115 lineto
   460  122 lineto  461  127 lineto  470  129 lineto  480  140 lineto
   499  146 lineto  510  145 lineto  513  148 lineto  517  145 lineto
   526  147 lineto  531  166 lineto  533  166 lineto  534  193 lineto
   548  202 lineto  582  212 lineto  587  217 lineto  598  218 lineto
   607  215 lineto  616  200 lineto  622  198 lineto  624  201 lineto
   632  204 lineto  634  211 lineto  647  217 lineto  663  202 lineto
   662  185 lineto  664  180 lineto  663  170 lineto  671  153 lineto
   674  133 lineto  681  126 lineto  691  120 lineto  695  111 lineto
   698   99 lineto  709   91 lineto  714   69 lineto  724   60 lineto
   738   53 lineto  742   55 lineto  749   52 lineto  752   41 lineto
   758   40 lineto  758   30 lineto  768   28 lineto  768   18 lineto
   789    7 lineto  790    0 lineto
     0    0 lineto
   935    0 moveto  970   21 lineto  986   22 lineto  989   30 lineto
   997   30 lineto 1006   35 lineto 1016   34 lineto 1023   38 lineto
  1040   51 lineto 1053   55 lineto 1057   51 lineto 1063   57 lineto
  1072   59 lineto 1077   66 lineto 1087   70 lineto 1089   70 lineto
  1097   63 lineto 1098   58 lineto 1104   57 lineto 1108   59 lineto
  1116   57 lineto 1129   56 lineto 1130   47 lineto 1141   38 lineto
  1158   41 lineto 1182   46 lineto 1202   45 lineto 1206   41 lineto
  1219   39 lineto 1226   41 lineto 1228   48 lineto 1246   49 lineto
  1249   52 lineto 1254   48 lineto 1255   39 lineto 1267   36 lineto
  1268   33 lineto 1278   27 lineto 1286   26 lineto 1287   10 lineto
  1293    9 lineto 1295    0 lineto
   935    0 lineto
  closepath
  1293 vedra_width div dup scale
  vedra_x1 -1 mul vedra_y1 -1 mul translate
} bind def

/slouchmanprofile {  % x y height direction slouchmanprofile   (sets path)
  10 dict begin
    [ /directn /height /y /x ] { exch def } forall
    x       y       translate height 106 div dup scale directn {-1 1 scale} if
    0 0 moveto 8 0 12 2 12 4 curveto 13 44 lineto 17 46 lineto 18 68 lineto
    18 80 12 88 7 93 curveto 3 97 1 106 -4 106 curveto % now at top of head
    -10 106 -14 103 -14 97 curveto -14 96 -14 90 -6 86 curveto
    -8 81 lineto  % now at shoulder
    -8 65 -4 60 -4 55 curveto -3 7 lineto -12 5 lineto
    -12 3 -10 2 -8 2 curveto  -8 0 -6 0 0 0 curveto
    closepath
    directn {-1 1 scale} if 106 height div dup scale 0 x sub 0 y sub translate
  end
} bind def

